<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Gpsd-dev] [PATCH] Restore leapsecond.py Python output
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/gpsd-dev/2011-January/index.html" >
   <LINK REL="made" HREF="mailto:gpsd-dev%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-dev%5D%20%5BPATCH%5D%20Restore%20leapsecond.py%20Python%20output&In-Reply-To=%3C1295261377-6994-1-git-send-email-bbolli%40ewanet.ch%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="008494.html">
   <LINK REL="Next"  HREF="008498.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gpsd-dev] [PATCH] Restore leapsecond.py Python output</H1>
    <B>Beat Bolli</B> 
    <A HREF="mailto:gpsd-dev%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-dev%5D%20%5BPATCH%5D%20Restore%20leapsecond.py%20Python%20output&In-Reply-To=%3C1295261377-6994-1-git-send-email-bbolli%40ewanet.ch%3E"
       TITLE="[Gpsd-dev] [PATCH] Restore leapsecond.py Python output">bbolli at ewanet.ch
       </A><BR>
    <I>Mon Jan 17 11:49:37 CET 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="008494.html">[Gpsd-dev] GPS date fail due to week counter rollover (not a gpsd bug)
</A></li>
        <LI>Next message: <A HREF="008498.html">[Gpsd-dev] [PATCH] Sorting Satellites in SkyView
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8497">[ date ]</a>
              <a href="thread.html#8497">[ thread ]</a>
              <a href="subject.html#8497">[ subject ]</a>
              <a href="author.html#8497">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>---
 leapsecond.py |   28 ++++++++++++++++++----------
 1 files changed, 18 insertions(+), 10 deletions(-)

diff --git a/leapsecond.py b/leapsecond.py
index 89cc292..196e1da 100755
--- a/leapsecond.py
+++ b/leapsecond.py
@@ -132,11 +132,11 @@ if __name__ == '__main__':
     next = False
     from_rfc822 = False
     to_rfc822 = False
-    listepochs = c_epochs = py_epochs = False
+    c_epochs = py_epochs = False
     (options, arguments) = getopt.getopt(sys.argv[1:], &quot;ci:n:o:p&quot;)
     for (switch, val) in options:
         if (switch == '-c'):
-            listepochs = c_epochs = True
+            c_epochs = True
         elif (switch == '-i'):  # Compute Unix time from RFC822 date
             from_rfc822 = True
         elif (switch == '-n'):  # Compute possible next leapsecond
@@ -144,9 +144,9 @@ if __name__ == '__main__':
         elif (switch == '-o'):  # Compute RFC822 date from Unix time
             to_rfc822 = True
         elif (switch == '-p'):
-            listepochs = py_epochs = True
+            py_epochs = True
 
-    if not next and not from_rfc822 and not to_rfc822 and not listepochs:
+    if not next and not from_rfc822 and not to_rfc822 and not c_epochs and not py_epochs:
         print &quot;Current leap second:&quot;, retrieve()
         raise SystemExit, 0
 
@@ -158,7 +158,7 @@ if __name__ == '__main__':
         print unix_to_rfc822(float(val))
         raise SystemExit, 0
 
-    if listepochs:
+    if c_epochs or py_epochs:
         skip = True
         leapsecs = []
         # This code assumes that after 1980, leap-second increments are
@@ -172,6 +172,11 @@ if __name__ == '__main__':
             fields = line.strip().split()
             leapsecs.append(leapbound(fields[0], fields[1]))
         leapsecs.append(unix_to_rfc822(time.time()))
+	def label(i):
+	    if i == len(leapsecs) - 1:
+		return '?'
+	    else:
+		return str(i)
         if c_epochs:
             print '''
 /* This code is generated from leapsecond.py; do not hand-hack! */
@@ -184,11 +189,7 @@ int gpsd_check_leapsecond(const int leap, const double unixtime)
     static double c_epochs[] = {\
 '''
             for (i, b) in enumerate(leapsecs):
-                if i == len(b) - 1:
-                    label = '?'
-                else:
-                    label = `i`
-                print &quot;        %s,    // %s -&gt; %s&quot; % (rfc822_to_unix(b), b, label)
+                print &quot;        %s,    // %s -&gt; %s&quot; % (rfc822_to_unix(b), b, label(i))
             print '''\
     };
     #define DIM(a) (sizeof(a)/sizeof(a[0]))
@@ -203,6 +204,13 @@ int gpsd_check_leapsecond(const int leap, const double unixtime)
         return 0;    /* leap second inconsistent, probable rollover error */
 }
 '''
+	else:
+	    leapsecs = [(rfc822_to_unix(l), b, label(b)) for (i, b) in enumerate(leapsecs)]
+	    import pprint
+	    print '''# This table is generated by leapsecond.py; do not hand-hack!
+
+leapsecs ='''
+	    pprint.pprint(leapsecs)
         raise SystemExit, 0
 
     if val[:3].lower() not in (&quot;jun&quot;, &quot;dec&quot;):
-- 
1.7.2.3

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="008494.html">[Gpsd-dev] GPS date fail due to week counter rollover (not a gpsd bug)
</A></li>
	<LI>Next message: <A HREF="008498.html">[Gpsd-dev] [PATCH] Sorting Satellites in SkyView
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#8497">[ date ]</a>
              <a href="thread.html#8497">[ thread ]</a>
              <a href="subject.html#8497">[ subject ]</a>
              <a href="author.html#8497">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/gpsd-dev">More information about the Gpsd-dev
mailing list</a><br>
</body></html>
