<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Gpsd-dev] What's the i command supposed to report?
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/gpsd-dev/2008-July/index.html" >
   <LINK REL="made" HREF="mailto:gpsd-dev%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-dev%5D%20What%27s%20the%20i%20command%20supposed%20to%20report%3F&In-Reply-To=%3CFB01D084E01F4472B72F09E070DD285F.MAI%40sohosted42.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006110.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gpsd-dev] What's the i command supposed to report?</H1>
    <B>gpsd at hfijnvandraat.nl</B> 
    <A HREF="mailto:gpsd-dev%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-dev%5D%20What%27s%20the%20i%20command%20supposed%20to%20report%3F&In-Reply-To=%3CFB01D084E01F4472B72F09E070DD285F.MAI%40sohosted42.com%3E"
       TITLE="[Gpsd-dev] What's the i command supposed to report?">gpsd at hfijnvandraat.nl
       </A><BR>
    <I>Sat Jul 26 21:44:05 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="006110.html">[Gpsd-dev] gpsctl -t does not set device type  gpsd 2.36
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6111">[ date ]</a>
              <a href="thread.html#6111">[ thread ]</a>
              <a href="subject.html#6111">[ subject ]</a>
              <a href="author.html#6111">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> On Sat, Jul 26, 2008 at 6:21 AM,  &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/gpsd-dev">gpsd at hfijnvandraat.nl</A>&gt; wrote:
</I>&gt;&gt;<i> Should the i command only report the main protocol groups, Generic NMEA, Sirf, UBX and so,
</I>&gt;&gt;<i> or should it be able to tell which specific GPS receiver is in use?
</I>&gt;<i>
</I>&gt;<i>yes
</I>&gt;<i>
</I>&gt;&gt;<i> That is: I can tell my FV-M11 from other NMEA units by its response to a $PMKT000 command,
</I>&gt;&gt;<i> but it can use the generic NMEA driver, but then it remains a Generic NMEA for the i command
</I>&gt;<i>
</I>&gt;<i>it depends on what your receiver says in response to a probe.
</I>&gt;<i>Sometimes we can only tell that we're looking at a given vendor (ie.
</I>&gt;<i>garmin). Sometimes we can tell whether we're looking at a particular
</I>&gt;<i>revision of a chipset (GSW2 -&gt; sirf2, GSW3 -&gt; sirf3). Sometimes the
</I>&gt;<i>device will actually identify itself (eg. a Thales AC12 will report
</I>&gt;<i>that it's an AC12 running some particular firmware version rather than
</I>&gt;<i>an A12)
</I>&gt;<i>
</I>So that leaves me with some questions for the gpsd newbies list ;-))

in drivers.c probe seems to come in two flavors: .probe_detect and .probe_subtype
.probe_detect = NULL everywhere and .probe_subtype refers mostly to nmea_probe_subtype()

on startup in debug mode the output reads somewhere: no probe matched...
that seems the result from .probe_detect = NULL

When I hook-up my BU-353 the next probing output is: switch_driver(SiRF binary) called...
which seems the product of nmea_probe_subtype()

Now lets try to connect a FV-M11 (through an FTDI 232R - 3V3)

To do so I added structs/code akin to the existing FV18 stuff.
it sends a $PMTK000 and .trigger is set to $PMKT001,0,3
sending the probe works fine the .trigger is generated by the device and it also
replies with the error $PMKT001,-1 to the probe strings for other devices.

now how is the .trigger $PMKT001,0,3 handled:
it ends up in nmea_parse_input() at this code:

&lt;snip&gt;
	if ((st=nmea_parse((char *)session-&gt;packet.outbuffer, session))==0) {
#ifdef NON_NMEA_ENABLE
	    struct gps_type_t **dp;

	    /* maybe this is a trigger string for a driver we know about? */
	    for (dp = gpsd_drivers; *dp; dp++) {
		char	*trigger = (*dp)-&gt;trigger;

		if (trigger!=NULL &amp;&amp; strncmp((char *)session-&gt;packet.outbuffer, trigger, strlen(trigger))==0 &amp;&amp;
isatty(session-&gt;gpsdata.gps_fd)!=0) {
		    gpsd_report(LOG_PROG, &quot;found %s.\n&quot;, trigger);
		    (void)gpsd_switch_driver(session, (*dp)-&gt;type_name);
		    return 1;
		}
	    }
#endif /* NON_NMEA_ENABLE */
	    gpsd_report(LOG_WARN, &quot;unknown sentence: \&quot;%s\&quot;\n&quot;, session-&gt;packet.outbuffer);
	}
&lt;snip&gt;

Great, indeed it is: a trigger string for a driver we know about
BUT, it is a reply to a subtype probe which - thinks humble me - should not invoke a
gpsd_switch_driver()
- humble me - expects it to store the .type_name      = &quot;San Jose Navigation FV-M11&quot; into
session_subtype[64]

The i command replies to the client with the concatenation of the &quot;Generic NMEA&quot; and this
session_subtype

It also leaves me with a question regarding vendor specific NMEA strings: how are those handled?
need a separate driver, should/can they be added to nmea_parse() ???

But of course it could just be that I have to dig deeper to find the answers?

Henk







</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006110.html">[Gpsd-dev] gpsctl -t does not set device type  gpsd 2.36
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6111">[ date ]</a>
              <a href="thread.html#6111">[ thread ]</a>
              <a href="subject.html#6111">[ subject ]</a>
              <a href="author.html#6111">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/gpsd-dev">More information about the Gpsd-dev
mailing list</a><br>
</body></html>
