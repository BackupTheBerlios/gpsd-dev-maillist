<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Gpsd-dev] r6572 gpsd_maskdump not defined
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/gpsd-dev/2009-November/index.html" >
   <LINK REL="made" HREF="mailto:gpsd-dev%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-dev%5D%20r6572%20gpsd_maskdump%20not%20defined&In-Reply-To=%3Crmik4xklmke.fsf%40fnord.ir.bbn.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007130.html">
   <LINK REL="Next"  HREF="007133.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gpsd-dev] r6572 gpsd_maskdump not defined</H1>
    <B>Greg Troxel</B> 
    <A HREF="mailto:gpsd-dev%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-dev%5D%20r6572%20gpsd_maskdump%20not%20defined&In-Reply-To=%3Crmik4xklmke.fsf%40fnord.ir.bbn.com%3E"
       TITLE="[Gpsd-dev] r6572 gpsd_maskdump not defined">gdt at ir.bbn.com
       </A><BR>
    <I>Sat Nov 21 01:59:45 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="007130.html">[Gpsd-dev] r6572 gpsd_maskdump not defined
</A></li>
        <LI>Next message: <A HREF="007133.html">[Gpsd-dev] r6572 gpsd_maskdump not defined
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7131">[ date ]</a>
              <a href="thread.html#7131">[ thread ]</a>
              <a href="subject.html#7131">[ subject ]</a>
              <a href="author.html#7131">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&quot;Eric S. Raymond&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/gpsd-dev">esr at thyrsus.com</A>&gt; writes:

&gt;<i> Greg Troxel &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/gpsd-dev">gdt at ir.bbn.com</A>&gt;:
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ./.libs/libgps.so: undefined reference to `gpsd_maskdump'
</I>&gt;&gt;<i> gmake[1]: *** [gpsdecode] Error 1
</I>&gt;&gt;<i> gmake[1]: Leaving directory `/home/gdt/SOFTWARE/GPSD/gpsd-trunk-https'
</I>&gt;&gt;<i> gmake: *** [check] Error 2
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> I can't find the definition using emacs-etags or grep.
</I>&gt;<i>
</I>&gt;<i> A file named maskdump.c should be generated by maskaudit.py during
</I>&gt;<i> normal make processing; it's in there. If you don't have a maskdump.c,
</I>&gt;<i> there's a build issue.
</I>
There are two build issues:

  maskaudit.py assumes &quot;/usr/bin/env python&quot; finds python, which is
  unportable.  python changes so much with each version that in pkgsrc N
  versions are parallel installable as python2.5 etc., and
  python-depending programs find them and bind explicitly.  gpsd's
  configure.ac finds python, but maskaudit.py doesn't have it
  substituted as it should.

  Makefile.am called maskaudit.py without checking exit status, turning
  what should have been a fatal error stopping the build into silent
  corruption, leaving a maskdump.c of zero length.

Patch to fix this (svn mv maskaudit.py maskaudit.py.in and edit to
change first line, plus configure.ac to generate maskaudit.py and chmod
it, and changing implied ; between commands to &amp;&amp; in Makefile.am.
Tested on NetBSD where this failure arose, and seems like the right
thing regardless.

OK to commit?


Index: configure.ac
===================================================================
--- configure.ac	(revision 6576)
+++ configure.ac	(working copy)
@@ -1094,6 +1094,7 @@
     x&quot;$ac_ubx&quot; = &quot;xno&quot;; then
     AC_MSG_ERROR(Can't build gpsd with no protocols enabled)
 fi
-AC_OUTPUT(Makefile packaging/gpsd.spec libgps.pc libgpsd.pc)
+AC_OUTPUT(Makefile packaging/gpsd.spec libgps.pc libgpsd.pc maskaudit.py,
+		   [chmod +x maskaudit.py])
 echo &quot;Configure finished, type 'make' to build.&quot;
 
Index: maskaudit.py.in
===================================================================
--- maskaudit.py.in	(revision 6576)
+++ maskaudit.py.in	(working copy)
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!@PYTHON@
 #
 # With -t, report on which status masks are used in the daemon vs. the
 # client-side library.
Index: Makefile.am
===================================================================
--- Makefile.am	(revision 6576)
+++ Makefile.am	(working copy)
@@ -215,8 +215,8 @@
 	@chmod a-w $(srcdir)/revision.h
 
 maskdump.c: gpsd.h-tail maskaudit.py
-	rm -f $(srcdir)/maskdump.c
-	$(srcdir)/maskaudit.py -c &gt;maskdump.c
+	rm -f $(srcdir)/maskdump.c &amp;&amp; \
+	$(srcdir)/maskaudit.py -c &gt;maskdump.c &amp;&amp; \
 	chmod a-w $(srcdir)/maskdump.c
 
 libgps_la_SOURCES = $(libgpsd_c_sources) $(libgpsd_h_sources) \
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 194 bytes
Desc: not available
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/gpsd-dev/attachments/20091120/3e7f2f4e/attachment.pgp">https://lists.berlios.de/pipermail/gpsd-dev/attachments/20091120/3e7f2f4e/attachment.pgp</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007130.html">[Gpsd-dev] r6572 gpsd_maskdump not defined
</A></li>
	<LI>Next message: <A HREF="007133.html">[Gpsd-dev] r6572 gpsd_maskdump not defined
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7131">[ date ]</a>
              <a href="thread.html#7131">[ thread ]</a>
              <a href="subject.html#7131">[ subject ]</a>
              <a href="author.html#7131">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/gpsd-dev">More information about the Gpsd-dev
mailing list</a><br>
</body></html>
