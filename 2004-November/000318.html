<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Gpsd-dev] building gpsd-2.3 on debian (gpsprobe)
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/gpsd-dev/2004-November/index.html" >
   <LINK REL="made" HREF="mailto:gpsd-dev%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-dev%5D%20building%20gpsd-2.3%20on%20debian%20%28gpsprobe%29&In-Reply-To=%3C20041109220957.17a003db.hamish_nospam%40yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000317.html">
   <LINK REL="Next"  HREF="000320.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Gpsd-dev] building gpsd-2.3 on debian (gpsprobe)</H1>
    <B>Hamish</B> 
    <A HREF="mailto:gpsd-dev%40lists.berlios.de?Subject=Re%3A%20%5BGpsd-dev%5D%20building%20gpsd-2.3%20on%20debian%20%28gpsprobe%29&In-Reply-To=%3C20041109220957.17a003db.hamish_nospam%40yahoo.com%3E"
       TITLE="[Gpsd-dev] building gpsd-2.3 on debian (gpsprobe)">hamish_nospam at yahoo.com
       </A><BR>
    <I>Tue Nov  9 10:09:57 CET 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000317.html">[Gpsd-dev] building gpsd-2.3 on debian (missing Xaw)
</A></li>
        <LI>Next message: <A HREF="000320.html">[Gpsd-dev] building gpsd-2.3 on debian (gpsprobe)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#318">[ date ]</a>
              <a href="thread.html#318">[ thread ]</a>
              <a href="subject.html#318">[ subject ]</a>
              <a href="author.html#318">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>gpsprobe was giving:

$ ./gpsprobe -h
  File &quot;./gpsprobe&quot;, line 64
    else (switch == '-h'):
         ^
SyntaxError: invalid syntax


[python Version: 2.3.4-4]


so this patch (I know zero python):


--- gpsprobe.ORIG       2004-11-09 20:57:54.000000000 +1300
+++ gpsprobe    2004-11-09 20:59:14.000000000 +1300
@@ -61,8 +61,9 @@
     for (switch, val) in options:
        if (switch == '-n'):
            await = int(val)
-        else (switch == '-h'):
-            sys.stderr.write(&quot;usage: gpsprobe [-h] [-n samplecount] [device]\n&quot;)
+        else:
+           if (switch == '-h'):
+                sys.stderr.write(&quot;usage: gpsprobe [-h] [-n samplecount] [device]\n&quot;)
     if arguments:
         device = arguments[0]



but then I get:
[Garmin 48  NMEA 183 v2.0 @ 4800 baud]


$ ./gpsprobe
Waiting for /dev/gps......(0.00 sec) acquired.
Gathering 100 sentences will probably take about 33 seconds.
Looking for first fix...Traceback (most recent call last):
  File &quot;./gpsprobe&quot;, line 137, in ?
    status = dev.poll()
  File &quot;/usr/src/gpsd-2.3/gpsd.py&quot;, line 314, in poll
    self.devtype.parser.handler(self.ttyfp, self.raw_hook)
  File &quot;/usr/src/gpsd-2.3/gpsd.py&quot;, line 200, in handler
    self.handle_line(linebuf[:-2])
  File &quot;/usr/src/gpsd-2.3/gpsd.py&quot;, line 192, in handle_line
    NMEA.__dict__['process'+words[0]](self, words[1:])
  File &quot;/usr/src/gpsd-2.3/gpsd.py&quot;, line 123, in processGPGSA
    self.data.vdop = float(words[16])
ValueError: empty string for float()



hmmm, I just tried a 5th time (without changing anything), and it went:

$ ./gpsprobe
Waiting for /dev/gps......(0.00 sec) acquired.
Gathering 100 sentences will probably take about 33 seconds.
Looking for first fix......(2.47 sec) got it.
Gathering fixes......(14.60 sec) None.
# This is a gnuplot script generated by gpsprobe at Tue Nov  9 21:03:45 2004

# First fix in 2.471952 seconds.
# GPWPL: is emitted once every 2 seconds.
# GPGSA: is emitted once every 2 seconds.
# PGRMZ: is emitted once every 2 seconds.
# GPRMC: is probably emitted once every 2 seconds.
# GPRMB: is emitted once every 2 seconds.
# PGRMM: is emitted once every 2 seconds.
# GPGSV: is emitted once every 2 seconds.
# GPGLL: is emitted once every 2 seconds.
# GPBOD: is emitted once every 2 seconds.
# PGRME: is emitted once every 2 seconds.
# GPGGA: is emitted once every 2 seconds.
# Send cycle is once per 2 seconds.
# GPRMC format indicates NMEA version &lt; 2.3.

set autoscale
set key below
set key title &quot;Tue Nov  9 21:03:45 2004&quot;
set size ratio -1
set xlabel &quot;Meters east from 170.510783E&quot;
set ylabel &quot;Meters north from 45.869600S&quot;
cep=0.189797
set parametric
set trange [0:2*pi]
cx(t, r) = sin(t)*r
cy(t, r) = cos(t)*r
chlen = cep/20
set arrow from -chlen,0 to chlen,0 nohead
set arrow from 0,-chlen to 0,chlen nohead
plot &quot;-&quot; using 1:2 title &quot;100 GPS fixes&quot;, cx(t, cep),cy(t, cep) title &quot;CEP (50%) = 0.134207 meters&quot;
#
# Lat   Lon
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
  0.134207      0.134207
end



but not the sixth time:

$ ./gpsprobe &gt; gp_plot.txt
Waiting for /dev/gps......(0.00 sec) acquired.
Gathering 100 sentences will probably take about 33 seconds.
Looking for first fix......(2.10 sec) got it.
Gathering fixes......(14.66 sec) None.
EarthDistance: {'y2': 731057.80952297582, 'lat1': -45.869583333333239, 'lat2': -45.869583333333239, 'lon2': 170.51080000000005, '.0': (-45.869583333333239, 170.51080000000005), 'y1': 731057.80952297582, 'lon1': 170.51080000000005, 'x2': -4373693.5581904268, '.2': (-45.869583333333239, 170.51080000000005), 'x1': -4373693.5581904268, 'z1': -4571057.1014228771, 'z2': -4571057.1014228771}
Traceback (most recent call last):
  File &quot;./gpsprobe&quot;, line 213, in ?
    recentered = map(lambda fix: gps.MeterOffset(centroid, fix), fixes)
  File &quot;./gpsprobe&quot;, line 213, in &lt;lambda&gt;
    recentered = map(lambda fix: gps.MeterOffset(centroid, fix), fixes)
  File &quot;/usr/src/gpsd-2.3/gps.py&quot;, line 316, in MeterOffset
    return ( \
  File &quot;/usr/src/gpsd-2.3/gps.py&quot;, line 311, in EarthDistance
    raise ValueError
ValueError


gp_plot.txt:
# This is a gnuplot script generated by gpsprobe at Tue Nov  9 21:06:30 2004

# First fix in 2.103653 seconds.
# GPWPL: is probably emitted once every 1 seconds.
# GPGSA: is emitted once every 2 seconds.
# PGRMZ: is probably emitted once every 2 seconds.
# GPRMC: is emitted once every 2 seconds.
# GPRMB: is emitted once every 2 seconds.
# PGRMM: is probably emitted once every 2 seconds.
# GPGSV: is emitted once every 2 seconds.
# GPGLL: is probably emitted once every 2 seconds.
# GPBOD: is probably emitted once every 2 seconds.
# PGRME: is emitted once every 2 seconds.
# GPGGA: is emitted once every 2 seconds.
# Send cycle is once per 1 seconds.
# GPRMC format indicates NMEA version &lt; 2.3.


[note GPWPL seems to be out of sync]

...after hooking up to an antenna running out the window (solid fixes),
I get:

$ ./gpsprobe
Waiting for /dev/gps......(0.00 sec) acquired.
Gathering 100 sentences will probably take about 33 seconds.
Looking for first fix...Traceback (most recent call last):
  File &quot;./gpsprobe&quot;, line 137, in ?
    status = dev.poll()
  File &quot;/usr/src/gpsd-2.3/gpsd.py&quot;, line 314, in poll
    self.devtype.parser.handler(self.ttyfp, self.raw_hook)
  File &quot;/usr/src/gpsd-2.3/gpsd.py&quot;, line 200, in handler
    self.handle_line(linebuf[:-2])
  File &quot;/usr/src/gpsd-2.3/gpsd.py&quot;, line 192, in handle_line
    NMEA.__dict__['process'+words[0]](self, words[1:])
  File &quot;/usr/src/gpsd-2.3/gpsd.py&quot;, line 123, in processGPGSA
    self.data.vdop = float(words[16])
ValueError: empty string for float()



GPSGA line  [Garmin 48  NMEA 183 v2.0]:
gpsd: &lt;= GPS: $GPGSA,A,2,01,,,13,16,20,,,,,,,2.1,2.1,*1B
gpsd: GPGSA sets mode 2
gpsd: GPS has a fix (status=1, mode=2).

whole message series looks like:

$GPBOD,180.1,T,154.8,M,A,B*44
$GPRTE,1,1,c,0,B,A*04
$GPWPL,4550.822,S,17030.074,E,B*1E
$GPRMC,083953,A,4552.169,S,17030.647,E,000.0,360.0,091104,025.3,E*6B
$GPRMB,A,0.40,R,B,A,4551.823,S,17030.072,E,000.5,310.7,,V*10
$GPGGA,083953,4552.169,S,17030.647,E,1,04,2.1,20.2,M,2.3,M,,*55
$GPGSA,A,2,01,,,13,16,20,,,,,,,2.1,2.1,*1B

$GPGSV,3,1,09,01,42,071,37,04,07,224,30,06,10,128,00,13,20,239,34*70
$GPGSV,3,2,09,16,59,044,55,20,53,313,51,23,57,234,31,24,00,193,31*70
$GPGSV,3,3,09,25,42,115,00,,,,,,,,,,,,*44
$PGRME,8.1,M,,M,8.1,M*00
$GPGLL,4552.169,S,17030.647,E,083953,A*3B
$PGRMZ,66,f,2*2A
$PGRMM,WGS 84*06



Changing the Garmin 48 to output NMEA 183 v1.5:

$GPVTG,360.0,T,334.7,M,000.0,N,000.0,K*48
$GPRMC,084107,A,4552.17,S,17030.65,E,000.0,360.0,091104,025.3,E*6B
$GPRMB,A,0.40,R,B,A,4551.82,S,17030.07,E,000.5,310.8,,V*1E
$GPWPL,4550.82,S,17030.07,E,B*18
$GPWPL,4551.82,S,17030.07,E,A*1A
$GPGLL,4552.17,S,17030.65,E*70
$PGRMZ,66,f,2*2A
$PGRMM,WGS 84*06
$GPXTE,A,A,0.40,R,N*74
$GPBOD,180.1,T,154.8,M,A,B*44
$GPBWC,084107,4551.82,S,17030.07,E,310.8,T,285.5,M,000.5,N,A*5D


and ./gpsprobe searches in vain for a first fix which will never arrive..
./gps only sees &quot;=?&quot;

shrug. NMEA 183 v2.0 seems to be a requirement.



For curiosity purposes:

Changing the Garmin 48 to output NMEA 182 (1200 baud 7,1,odd):
just spits out likes line:
$GPN0.40LM28645D52.17'S170D30.65'E@

Changing the Garmin 48 to output NMEA 180 (1200 baud):
just puts out jibberish I can't figure out.


and now I switch back to NMEA 183 v2.0 and it seems to work.... aaagh

$ ./gpsprobe | gnuplot -persist
Waiting for /dev/gps......(0.00 sec) acquired.
Gathering 100 sentences will probably take about 33 seconds.
Looking for first fix......(1.76 sec) got it.
Gathering fixes......(15.92 sec) None.

[draws ok]


... a few minutes later it breaks again. Sorry, didn't catch a GPGSA
string when it was working.



Hamish

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000317.html">[Gpsd-dev] building gpsd-2.3 on debian (missing Xaw)
</A></li>
	<LI>Next message: <A HREF="000320.html">[Gpsd-dev] building gpsd-2.3 on debian (gpsprobe)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#318">[ date ]</a>
              <a href="thread.html#318">[ thread ]</a>
              <a href="subject.html#318">[ subject ]</a>
              <a href="author.html#318">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/gpsd-dev">More information about the Gpsd-dev
mailing list</a><br>
</body></html>
